var ue=Object.defineProperty;var pe=(t,e,s)=>e in t?ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var L=(t,e,s)=>(pe(t,typeof e!="symbol"?e+"":e,s),s);import{c as v,r as z,o as m,a as G,m as x,d as Y,b as S,e as C,f as M,g as N,h as $,u as i,w as a,i as U,F as j,_ as _e,j as F,k as h,t as k,l as b,n as r,p as T,B as q,M as ee,I as fe,q as me,U as ge,P as he,s as K,v as ve,x as te,S as we,y as ye,z as V,A as se,C as oe,D as be,E as ke,L as Se,G as xe,H as De,J as Le,K as $e,N as Ce,O as Oe,Q as ne,R as ae,T as Ue,V as Me,W as Ie,X as Ne,Y as Fe,Z as Pe,$ as Ae,a0 as Re,a1 as Te,a2 as qe,a3 as He,a4 as Ee,a5 as je,a6 as Ke,a7 as Be,a8 as Je,a9 as ze}from"./vendor.223ccf0f.js";const We=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}};We();var P=(t,e)=>{const s=t.__vccOpts||t;for(const[o,n]of e)s[o]=n;return s};const Ve={};function Qe(t,e){const s=z("router-view");return m(),v(s)}var Ze=P(Ve,[["render",Qe]]);const Ge={Accept:"application/json","Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"},Xe=t=>{const e=localStorage.getItem("accessToken");if(e!=null){if(t.headers===void 0)return t;t.headers.Authorization=`Bearer ${e}`}return t};class Ye{constructor(){L(this,"instance",null)}get http(){return this.instance!=null?this.instance:this.initHttp()}initHttp(){const e=G.create({baseURL:"",headers:Ge});return e.interceptors.request.use(Xe,s=>Promise.reject(s)),e.interceptors.response.use(s=>{if(s.headers&&s.headers.authorization){const o=s.headers.authorization.split(" ")[1];localStorage.setItem("accessToken",o)}return s},s=>{const{response:o}=s;return this.handleError(o)}),this.instance=e,e}request(e){return this.http.request(e)}get(e,s){return this.http.get(e,s)}post(e,s,o){return this.http.post(e,s,o)}put(e,s,o){return this.http.put(e,s,o)}delete(e,s){return this.http.delete(e,s)}handleError(e){const{status:s}=e;switch(console.error("response status= "+s),G.isAxiosError(e)?console.error("is axios error "+e):console.error("no axios error"+e),s){case 500:{x.error(`Internal server error(${s})`);break}case 403:{x.error(`Forbidden(${s})`);break}case 401:{x.error(`Unauthorized(${s})`);break}case 404:{x.error(`Not found(${s})`);break}case 429:{x.error(`Too many requests error(${s})`);break}default:x.error(`Unknown error(${s})`);break}return Promise.reject(e)}}const B=new Ye,et=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",slots:{customRender:"configured"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",slots:{customRender:"connected"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",slots:{customRender:"state"},filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]},{title:"Identify",key:"identify",dataIndex:"identify",slots:{customRender:"identify"}}],H=t=>{let e="Unknown";switch(t){case 1:e="Uncommissioned";break;case 2:e="Bootloader";break;case 3:e="Upgrading";break;case 4:e="Pairing";break;case 5:e="Commissioning";break;case 6:e="Joined";break;case 7:e="Orphan";break;case 8:e="Leaving";break}return e},Q=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",slots:{customRender:"configured"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",slots:{customRender:"connected"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",slots:{customRender:"state"},filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]}],tt=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",slots:{customRender:"configured"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",slots:{customRender:"connected"},filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",slots:{customRender:"state"},filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]},{title:"Progress",key:"progress",dataIndex:"progress",slots:{customRender:"progress"}}],J=async()=>{const t=[];try{(await B.get("/api/1/devices")).data.data.forEach(function(s){t.push({key:s.mac,name:s.name+`

`+s.ip,ip:s.ip,mac:s.mac,label:s.label,swversion:s.swversion,hwversion:s.hwversion,configured:s.configured,connected:s.connected,state:s.state,identify:s.mac,isSelect:!1,progress:0})})}catch(e){console.error("fetchDevices error= "+e)}return t},st=async t=>{try{return(await B.put(`/api/1/devices/${t}`,{command:"identify"})).data}catch(e){return console.error("identifyDevice error= "+e),null}};function re(t,e){t!==null&&(t.code===0&&e?x.success(e):x.error(t.message))}function ot(t){const e=t.split("/"),s=e[e.length-2];return console.log("mac= "+s),s}const O=Y("devices",{state:()=>({deviceList:[],upgradeMac:[],selectFirmware:""}),persist:{enabled:!0,strategies:[{key:"devices",storage:localStorage,paths:["deviceList"]}]},getters:{allDevices(t){return t.deviceList},selectedDevices(t){return t.deviceList.filter(e=>e.isSelect)},getUpgradeMac(t){return t.upgradeMac},selectedFirmware(t){return t.selectFirmware}},actions:{addUpgradeMac(t){this.upgradeMac=t},deleteUpgradeMac(){this.upgradeMac=[]},addSelectFirmware(t){this.selectFirmware=t},deleteSelectFirmware(){this.selectFirmware=""},addDevices(t){if(t.length===0)return;const e=this.deviceList.length===0;for(let s=0;s<t.length;s++)this.deviceList.find(n=>n.mac==t[s].mac)||this.deviceList.push(t[s]);if(!e)for(let s=0;s<this.deviceList.length;s++){const o=t.find(n=>n.mac===this.deviceList[s].mac);o?(this.deviceList[s].configured=o.configured,this.deviceList[s].connected=o.connected,this.deviceList[s].hwversion=o.hwversion,this.deviceList[s].key=o.key,this.deviceList[s].label=o.label,this.deviceList[s].mac=o.mac,this.deviceList[s].name=o.name,this.deviceList[s].ip=o.ip,this.deviceList[s].state=o.state,this.deviceList[s].swversion=o.swversion):this.deviceList.splice(s,1)}},updateSelectDevices(t){if(t.length===0){this.deviceList.forEach(e=>{e.isSelect=!1});return}for(let e=0;e<this.deviceList.length;e++){const s=this.deviceList[e].mac;for(let o=0;o<t.length;o++)if(s===t[o]){this.deviceList[e].isSelect=!0;break}else o===t.length-1&&(this.deviceList[e].isSelect=!1)}},addOrUpdateDevice(t){const e=this.deviceList.find(s=>s.mac===t.mac);e?(console.log("addOrUpdateDevice update device "+t.mac),e.configured=t.configured,e.connected=t.connected,e.hwversion=t.hwversion,e.label=t.label,e.mac=t.mac,e.name=t.name+`

`+t.ip,e.ip=t.ip,e.state=t.state,e.swversion=t.swversion):(console.log("addOrUpdateDevice add device "+t.mac),this.deviceList.push({key:t.mac,name:t.name+`

`+t.ip,ip:t.ip,mac:t.mac,label:t.label,swversion:t.swversion,hwversion:t.hwversion,configured:t.configured,connected:t.connected,state:t.state,identify:t.mac,isSelect:!1,progress:0}))},updateDeviceProperties(t,e){const s=ot(t),o=JSON.parse(e.toString()),n=this.deviceList.find(l=>l.mac===s);console.log(n),n&&o.data&&(JSON.stringify(o.data).includes("state")&&(console.log("state= "+o.data.state),n.state=o.data.state),JSON.stringify(o.data).includes("process")&&(console.log("process= "+o.data.process),n.progress=o.data.process),JSON.stringify(o.data).includes("label")&&(console.log("label= "+o.data.label),n.label=o.data.label),JSON.stringify(o.data).includes("ip")&&(console.log("ip= "+o.data.ip),n.ip=o.data.ip),JSON.stringify(o.data).includes("mac")&&(console.log("mac= "+o.data.mac),n.mac=o.data.mac),JSON.stringify(o.data).includes("swversion")&&(console.log("swversion= "+o.data.swversion),n.swversion=o.data.swversion),JSON.stringify(o.data).includes("connected")&&(console.log("connected= "+o.data.connected),n.connected=o.data.connected),JSON.stringify(o.data).includes("configured")&&(console.log("configured= "+o.data.configured),n.configured=o.data.configured))},resetAllDeviceProgress(){for(let t=0;t<this.deviceList.length;t++)this.deviceList[t].progress=0},delete(t){!t||this.deviceList.forEach((e,s)=>{e.mac===t.mac&&this.deviceList.splice(s,1)})},deleteAllDevice(){this.deviceList=[]}}}),nt=h("span",null," Please add device ",-1),at={style:{"{{ whiteSpace":"'pre-wrapper' }}"}},rt=b(" Identify "),it=S({setup(t){const e=C({loading:!1}),s=O();M();const o=(f,p,c)=>{console.log("params",f,p,c)};let n=M(new Map);const l=async f=>{n.value.set(f,!0);const p=await st(f);re(p,`Identify device [mac=${f}] success!`),(p==null?void 0:p.code)===0?setTimeout(()=>{n.value.set(f,!1)},5e3):n.value.set(f,!1)};return N(async()=>{e.loading=!0;const f=await J();s.addDevices(f),e.loading=!1}),(f,p)=>{const c=_e,d=T,u=q,_=F;return m(),$(j,null,[i(s).deviceList.length===0?(m(),v(c,{key:0,image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original","image-style":{height:"100px"},style:{margin:"100px 0 0 0 "}},{description:a(()=>[nt]),_:1})):U("",!0),i(s).deviceList.length!==0?(m(),v(_,{key:1,columns:i(et),"data-source":i(s).deviceList,loading:i(e).loading,pagination:!1,bordered:"",style:{margin:"0 10px 0 0"},onChange:o},{name:a(({text:g})=>[h("div",at,k(g),1)]),configured:a(({text:g})=>[h("span",null,[(m(),v(d,{key:g,color:g?"green":"volcano"},{default:a(()=>[b(k(g?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])]),connected:a(({text:g})=>[h("span",null,[(m(),v(d,{key:g,color:g?"green":"volcano"},{default:a(()=>[b(k(g?"Online":"Offline"),1)]),_:2},1032,["color"]))])]),state:a(({text:g})=>[h("span",null,[(m(),v(d,{key:g,color:g===1?"green":g===0?"volcano":"geekblue"},{default:a(()=>[b(k(i(H)(g)),1)]),_:2},1032,["color"]))])]),identify:a(({text:g})=>[h("span",null,[r(u,{key:"identify",type:"primary",shape:"round",loading:i(n).get(g),onClick:w=>l(g),style:{width:"100px"}},{default:a(()=>[rt]),_:2},1032,["loading","onClick"])])]),_:1},8,["columns","data-source","loading"])):U("",!0)],64)}}});const ct=S({emits:["selectDevices"],setup(t,{expose:e,emit:s}){const o=C({selectedRowKeys:[],loading:!1,visible:!1}),n=O(),l=c=>{console.log("selectedRowKeys changed: ",c),o.selectedRowKeys=c},f=()=>{n.updateSelectDevices(o.selectedRowKeys),s.call(this,"selectDevices"),o.visible=!1};return N(async()=>{o.loading=!0;const c=await J();n.addDevices(c),n.selectedDevices.length>0&&n.selectedDevices.filter(d=>d.isSelect).forEach(d=>o.selectedRowKeys.push(d.mac)),o.loading=!1}),e({showOrHideModal:c=>{o.visible=c}}),(c,d)=>{const u=T,_=F,g=ee;return m(),v(g,{visible:i(o).visible,"onUpdate:visible":d[0]||(d[0]=w=>i(o).visible=w),title:"Select Device",width:"100%","wrap-class-name":"full-modal",onOk:f},{default:a(()=>[r(_,{columns:i(Q),"data-source":i(n).deviceList,"row-selection":{selectedRowKeys:i(o).selectedRowKeys,onChange:l},loading:i(o).loading,pagination:!1,bordered:""},{configured:a(({text:w})=>[h("span",null,[(m(),v(u,{key:w,color:w?"green":"volcano"},{default:a(()=>[b(k(w?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])]),connected:a(({text:w})=>[h("span",null,[(m(),v(u,{key:w,color:w?"green":"volcano"},{default:a(()=>[b(k(w?"Online":"Offline"),1)]),_:2},1032,["color"]))])]),state:a(({text:w})=>[h("span",null,[(m(),v(u,{key:w,color:w===1?"green":w==0?"volcano":"geekblue"},{default:a(()=>[b(k(i(H)(w)),1)]),_:2},1032,["color"]))])]),_:1},8,["columns","data-source","row-selection","loading"])]),_:1},8,["visible"])}}}),X=async()=>{const t=[];try{const e=await B.get("/api/1/firmwares");if(e.data.data.length===0)return t;e.data.data.forEach(function(s){t.push({key:s,name:s})})}catch(e){console.error("fetchFirmwares error= "+e)}return t},lt=async(t,e)=>{try{return(await B.put("/api/1/firmwares",{filename:t,devices:e})).data}catch(s){console.error("updateFirmware error= "+s)}return null},dt={class:"ant-upload-drag-icon"},ut=h("p",{class:"ant-upload-text"},"Click or drag file to this area to upload",-1),pt=h("p",{class:"ant-upload-hint"}," Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files ",-1),_t=S({emits:["upload"],setup(t,{expose:e,emit:s}){const o=M([]);let n=M(!1);const l=p=>{const c=p.file.status;console.log("upload status "+c),c!=="uploading"&&console.log(p.file,p.fileList),c==="done"?(console.log("upload success"),s.call(this,"upload",!0)):c==="error"&&console.error("upload error")},f=p=>{n.value=p};return e({showOrHideModal:f}),(p,c)=>{const d=ge,u=ee;return m(),v(u,{visible:i(n),"onUpdate:visible":c[1]||(c[1]=_=>me(n)?n.value=_:n=_),title:"Select Firmware to upload",width:"40%",onOk:c[2]||(c[2]=_=>f(!1))},{default:a(()=>[r(d,{fileList:o.value,"onUpdate:fileList":c[0]||(c[0]=_=>o.value=_),name:"file",multiple:!0,action:"/api/1/firmwares",onChange:l},{default:a(()=>[h("p",dt,[r(i(fe))]),ut,pt]),_:1},8,["fileList"])]),_:1},8,["visible"])}}}),ft=S({emits:["selectedFirmware"],setup(t,{emit:e}){const s=[{title:"name",dataIndex:"name"}],o=C({selectedRowKeys:[],loading:!1,data:[]}),n=M(),l=()=>{var d;(d=n.value)==null||d.showOrHideModal(!0)},f=d=>{o.selectedRowKeys=d,e.call(this,"selectedFirmware",d[0]),c.addSelectFirmware(d[0])},p=async()=>{const d=await X();o.loading=!1,o.data=d},c=O();return N(async()=>{const d=await X();o.loading=!1,o.data=d,o.selectedRowKeys.push(c.selectFirmware)}),(d,u)=>{const _=q,g=K,w=F;return m(),$(j,null,[r(g,{justify:"end",style:{"margin-bottom":"16px"}},{default:a(()=>[r(_,{type:"primary",onClick:l,style:{width:"60px","margin-right":"20px"}},{default:a(()=>[r(i(he))]),_:1})]),_:1}),r(w,{"row-selection":{selectedRowKeys:i(o).selectedRowKeys,type:"radio",onChange:f},columns:s,showHeader:!1,"data-source":i(o).data,loading:i(o).loading,pagination:!1},null,8,["row-selection","data-source","loading"]),r(_t,{ref_key:"showUploadFirmware",ref:n,onUpload:p},null,512)],64)}}}),mt=S({emits:["selectDevices"],setup(t,{emit:e}){const s=C({selectedRowKeys:[],loading:!1,data:[],currentItem:"",ipList:[]}),o=O(),n=f=>{s.selectedRowKeys=f;const p=[];f.forEach(function(c){console.log("select device= "+c),p.push(c)}),e.call(this,"selectDevices",p)},l=f=>({disabled:f.state===3||!f.connected});return N(async()=>{s.loading=!0;const f=await J();s.loading=!1,s.data=f}),(f,p)=>{const c=T,d=F;return m(),v(d,{"row-selection":{selectedRowKeys:i(s).selectedRowKeys,getCheckboxProps:l,onChange:n},columns:i(Q),showHeader:!0,"data-source":i(o).deviceList,loading:i(s).loading,pagination:!1},{configured:a(({text:u})=>[h("span",null,[(m(),v(c,{key:u,color:u?"green":"volcano"},{default:a(()=>[b(k(u?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])]),connected:a(({text:u})=>[h("span",null,[(m(),v(c,{key:u,color:u?"green":"volcano"},{default:a(()=>[b(k(u?"Online":"Offline"),1)]),_:2},1032,["color"]))])]),state:a(({text:u})=>[h("span",null,[(m(),v(c,{key:u,color:u===1?"green":u===0?"volcano":"geekblue"},{default:a(()=>[b(k(i(H)(u)),1)]),_:2},1032,["color"]))])]),_:1},8,["row-selection","columns","data-source","loading"])}}}),gt=S({emits:["startUpgrade","resetUpgrade"],setup(t,{expose:e,emit:s}){const o=C({selectedRowKeys:[],loading:!1,data:[],startUpgrade:!1,startText:"Start",finish:!1}),n=O(),l=()=>{if(o.finish){console.log("back to device"),s.call(this,"resetUpgrade");return}o.startUpgrade=!0,o.startText="Starting",s.call(this,"startUpgrade")};return e({resetProgress:()=>{o.startUpgrade=!1,o.startText="Back",o.finish=!0}}),(p,c)=>{const d=T,u=ve,_=F,g=te,w=q,D=K;return m(),v(D,{justify:"center"},{default:a(()=>[r(g,{span:24,style:{"margin-top":"40px"}},{default:a(()=>[r(_,{columns:i(tt),showHeader:!0,"data-source":i(n).deviceList.filter(y=>i(n).upgradeMac.indexOf(y.mac)!==-1),loading:i(o).loading,pagination:!1},{configured:a(({text:y})=>[h("span",null,[(m(),v(d,{key:y,color:y?"green":"volcano"},{default:a(()=>[b(k(y?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])]),connected:a(({text:y})=>[h("span",null,[(m(),v(d,{key:y,color:y?"green":"volcano"},{default:a(()=>[b(k(y?"Online":"Offline"),1)]),_:2},1032,["color"]))])]),state:a(({text:y})=>[h("span",null,[(m(),v(d,{key:y,color:y===1?"green":y===0?"volcano":"geekblue"},{default:a(()=>[b(k(i(H)(y)),1)]),_:2},1032,["color"]))])]),progress:a(({text:y})=>[r(u,{percent:y,size:"small"},null,8,["percent"])]),_:1},8,["columns","data-source","loading"])]),_:1}),r(w,{type:"primary",loading:i(o).startUpgrade,size:"large",shape:"round",style:{width:"120px","margin-top":"40px"},onClick:l},{default:a(()=>[b(k(i(o).startText),1)]),_:1},8,["loading"])]),_:1})}}});const ht={style:{"margin-left":"-200px"}},vt=b(" Previous"),wt=b(" Next"),yt=S({setup(t){const e=C({selectedRowKeys:[],loading:!1,data:[],fileName:"",showUploadFirmware:null,currentStep:0,selectDevices:[]}),s=M(),o=O(),n=()=>{e.currentStep!==0&&e.currentStep--},l=()=>{if(console.log("click select step= "+e.currentStep),e.currentStep===0&&e.fileName===""){x.warn("Please select firmware firstly.");return}if(e.currentStep===1&&e.selectDevices.length===0){x.warn("Please select devices which you want to upgrade.");return}e.currentStep++},f=u=>{e.fileName=u,o.addSelectFirmware(u)},p=u=>{e.selectDevices=u,o.addUpgradeMac(u)},c=async()=>{var _;const u=await lt(e.fileName,e.selectDevices);re(u,"Upgrade has started!"),(_=s.value)==null||_.resetProgress()},d=()=>{e.currentStep=0,e.selectDevices=[],e.fileName="",o.resetAllDeviceProgress(),o.deleteUpgradeMac(),o.deleteSelectFirmware()};return(u,_)=>{const g=we,w=ye,D=te,y=K,I=q;return m(),$(j,null,[r(y,{class:"upgrade-steps",justify:"center",style:{"margin-top":"20px"}},{default:a(()=>[r(D,{span:24},{default:a(()=>[r(w,{current:i(e).currentStep,direction:"horizontal"},{default:a(()=>[r(g,{title:"Select firmware",description:"Select which version to upgrade."}),r(g,{title:"Select device",description:"Select devices to upgrade."}),r(g,{title:"Upgrade",description:"Confirm to upgrade."})]),_:1},8,["current"])]),_:1})]),_:1}),r(y,{justify:"center",style:{"margin-top":"40px","margin-bottom":"80px"}},{default:a(()=>[i(e).currentStep===0?(m(),v(D,{key:0,span:24},{default:a(()=>[r(ft,{onSelectedFirmware:f})]),_:1})):U("",!0),i(e).currentStep===1?(m(),v(D,{key:1,span:24},{default:a(()=>[r(mt,{onSelectDevices:p})]),_:1})):U("",!0),i(e).currentStep===2?(m(),v(D,{key:2,span:24},{default:a(()=>[r(gt,{onStartUpgrade:c,onResetUpgrade:d,ref_key:"upgradeProgressTable",ref:s},null,512)]),_:1})):U("",!0)]),_:1}),r(y,{justify:"center",class:"update-step-menu"},{default:a(()=>[h("div",ht,[i(e).currentStep>0&&i(e).currentStep<2?(m(),v(I,{key:0,type:"primary",size:"large",shape:"round",style:{"margin-right":"50px","margin-top":"20px",width:"120px"},onClick:n},{default:a(()=>[vt]),_:1})):U("",!0),i(e).currentStep<2?(m(),v(I,{key:1,type:"primary",size:"large",shape:"round",style:{width:"120px","margin-top":"20px"},onClick:l},{default:a(()=>[wt]),_:1})):U("",!0)])]),_:1}),r(ct,{ref:"showModalRef"},null,512)],64)}}});var bt=P(yt,[["__scopeId","data-v-277a16c5"]]);const kt=S({emits:["selectDevices"],setup(t,{expose:e,emit:s}){const o=C({selectedRowKeys:[],loading:!1,visible:!1}),n=O(),l=p=>{console.log("selectedRowKeys changed: ",p),o.selectedRowKeys=p};return N(async()=>{o.loading=!0;const p=await J();n.addDevices(p),n.selectedDevices.length>0&&n.selectedDevices.filter(c=>c.isSelect).forEach(c=>o.selectedRowKeys.push(c.mac)),o.loading=!1}),e({showOrHideModal:p=>{o.visible=p}}),(p,c)=>{const d=T,u=F;return m(),v(u,{columns:i(Q),"data-source":i(n).deviceList,"row-selection":{selectedRowKeys:i(o).selectedRowKeys,onChange:l},loading:i(o).loading,pagination:!1,bordered:""},{configured:a(({text:_})=>[h("span",null,[(m(),v(d,{key:_,color:_?"green":"volcano"},{default:a(()=>[b(k(_?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])]),connected:a(({text:_})=>[h("span",null,[(m(),v(d,{key:_,color:_?"green":"volcano"},{default:a(()=>[b(k(_?"Online":"Offline"),1)]),_:2},1032,["color"]))])]),state:a(({text:_})=>[h("span",null,[(m(),v(d,{key:_,color:_===1?"green":_==0?"volcano":"geekblue"},{default:a(()=>[b(k(i(H)(_)),1)]),_:2},1032,["color"]))])]),_:1},8,["columns","data-source","row-selection","loading"])}}}),St=S({setup(t){return(e,s)=>(m(),$("div",null,"Log"))}}),xt=S({name:"Device",setup(){console.log("setup")}});function Dt(t,e,s,o,n,l){return m(),$("div",null,"Help")}var Lt=P(xt,[["render",Dt]]);const $t=S({setup(){console.log("dashboard")}});function Ct(t,e,s,o,n,l){return m(),$("div",null," Dashboard ")}var Ot=P($t,[["render",Ct]]);const Z=Y("user",{state:()=>({user:{userName:"",password:""}}),persist:{enabled:!0,strategies:[{key:"currentUser",storage:localStorage}]},getters:{getUser(t){return t.user}},actions:{addUser(t){this.user=t},deleteUser(){this.user={userName:"",password:""}}}});const ie=t=>(se("data-v-03476488"),t=t(),oe(),t),Ut={class:"login-container"},Mt=ie(()=>h("h2",{class:"login-title"},"Wiser Zigbee Launcher",-1)),It=ie(()=>h("h2",{class:"title"},"Sign In",-1)),Nt=b("SIGN IN"),Ft=S({setup(t){const e=C({userName:"",password:"",ip:"",loginStart:!1}),s=V(),o=Z(),n=u=>{console.log(u,e)},l=u=>{console.log(u)},f=()=>{e.loginStart=!0,e.userName==="admin"&&e.password==="admin"?setTimeout(()=>{localStorage.setItem("accessToken","1234567890"),o.addUser({userName:e.userName,password:e.password,ips:[e.ip],currentIP:e.ip}),s.push("/home/device"),e.loginStart=!1},500):((e.userName!=="admin"||e.password!=="admin")&&x.error("Username or password error."),e.loginStart=!1)},d={checkUserName:[{validator:async(u,_)=>{if(_==="")return Promise.reject("Please input username")},trigger:"change"}],checkPassword:[{validator:async(u,_)=>{if(_==="")return Promise.reject("Please input password")},trigger:"change"}]};return(u,_)=>{const g=xe,w=De,D=Le,y=q,I=$e,E=be;return m(),$("div",Ut,[Mt,r(E,{class:"login-card"},{default:a(()=>[r(I,{model:i(e),rules:d,onFinish:n,onFinishFailed:l},{default:a(()=>[It,r(w,null,{default:a(()=>[r(g,{class:"inputBox",value:i(e).userName,"onUpdate:value":_[0]||(_[0]=R=>i(e).userName=R),placeholder:"Username"},{prefix:a(()=>[r(i(ke),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),_:1}),r(w,null,{default:a(()=>[r(D,{class:"inputBox",value:i(e).password,"onUpdate:value":_[1]||(_[1]=R=>i(e).password=R),placeholder:"Password"},{prefix:a(()=>[r(i(Se),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),_:1}),r(w,null,{default:a(()=>[r(y,{class:"submit",type:"primary",onClick:f,disabled:i(e).userName===""||i(e).password==="",loading:i(e).loginStart},{default:a(()=>[Nt]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}});var Pt=P(Ft,[["__scopeId","data-v-03476488"]]);class At{constructor(){L(this,"subjects");this.subjects=new Map}$on(e,s){this.subjects.set(e,s),console.log("add topic= "+e)}$emit(e,s){console.log("topic= "+e+" size= "+this.subjects.values.length),this.subjects.forEach((o,n)=>{console.log("topic= "+e+" key= "+n),e.indexOf(n)!==-1&&o(e,s)})}}const W=new At,Rt={class:"demo-dropdown-wrap"},Tt=b("U"),qt=b(" Log out "),Ht=S({setup(t){const e=V(),s=O(),o=Z(),n=({key:l})=>{console.log(`Click on item ${l}`),l==="logout"&&(localStorage.setItem("accessToken",""),s.deleteAllDevice(),o.deleteUser(),e.push("/login"))};return(l,f)=>{const p=Oe,c=ne,d=ae,u=Ue;return m(),$("div",Rt,[r(u,null,{overlay:a(()=>[r(d,{onClick:n},{default:a(()=>[r(c,{key:"logout"},{default:a(()=>[r(i(Ce)),qt]),_:1})]),_:1})]),default:a(()=>[r(p,{style:{color:"#f56a00","background-color":"#fde3cf"}},{default:a(()=>[Tt]),_:1})]),_:1})])}}});class Et{constructor(e,s,o,n){L(this,"mqclient");L(this,"brokerHost");L(this,"brokerPort");L(this,"endpoint");L(this,"protocol");L(this,"subscribeTopics");L(this,"subscribeCallbacks");this.brokerHost=e,this.brokerPort=s,this.endpoint=o,this.protocol=n,this.subscribeTopics=[],this.subscribeCallbacks=new Map}subscribe(e,s){this.subscribeTopics.push({topic:e,qos:s}),this.is_connected()&&this.mqclient.subscribe(e,{qos:s})}set_message_callback(e,s){this.subscribeCallbacks.set(e,s)}is_connected(){return this.mqclient.connected===!0}connect(e){try{this.mqclient=Me.exports.connect(`${this.protocol}://${this.brokerHost}:${this.brokerPort}${this.endpoint}`,e)}catch(s){console.error(s)}this.mqclient.on("connect",()=>{console.log(`connect success to mqtt server[${this.brokerHost}:${this.brokerPort}]`);for(let s=0;s<this.subscribeTopics.length;s++){const o=this.subscribeTopics[s];this.mqclient.subscribe(o.topic,{qos:o.qos})}}),this.mqclient.on("message",(s,o)=>{console.log("topic= "+s),this.subscribeCallbacks.forEach((n,l)=>{s.indexOf(l)!==-1&&n(s,o)})}),this.mqclient.on("error",()=>{console.log("connect failure to mqtt server")})}}const jt=S({setup(t,{expose:e}){const s=(n,l)=>{console.log(`update=>${l}`),W.$emit(n,l)};return e({connectMqtt:async n=>{console.log("connectMqtt");const l=new Et(n.host,n.port,n.endpoint,n.protocol);l.connect({username:n.user,password:n.pwd,clientId:n.id,clean:n.clean,connectTimeout:n.connectTimeout,reconnectPeriod:n.reconnectPeriod}),l.subscribe("v1.0/+/simulator/devices/+/update",2),l.subscribe("v1.0/+/simulator/devices/+/info",2),l.set_message_callback("update",s.bind(this)),l.set_message_callback("info",s.bind(this))}}),(n,l)=>(m(),$("div"))}});const A=t=>(se("data-v-2fd68a76"),t=t(),oe(),t),Kt=A(()=>h("div",{class:"app-logo"},"WZL",-1)),Bt=A(()=>h("span",null,"Device",-1)),Jt=A(()=>h("span",null,"Update",-1)),zt=A(()=>h("span",null,"Configure",-1)),Wt=A(()=>h("span",null,"Log",-1)),Vt=A(()=>h("span",null,"Help",-1)),Qt=S({setup(t){const e=V(),s=C({collapsed:!1,selectedKeys:[]}),o=M(),n=O(),l=Z();N(()=>{var d;console.log("on mounted");const p="mqttx_"+Math.random().toString(16).substring(2,8);let c={host:"localhost",port:8083,endpoint:"/mqtt",protocol:"ws",user:"",pwd:"",id:p,clean:!0,connectTimeout:1e4,reconnectPeriod:4e3};(d=o.value)==null||d.connectMqtt(c),window.addEventListener("beforeunload",u=>f(u))});const f=p=>{console.log("close browser"),n.resetAllDeviceProgress(),n.deleteSelectFirmware(),n.deleteUpgradeMac(),l.deleteUser()};return Ie(()=>{window.removeEventListener("beforeunload",p=>f())}),W.$on("info",(p,c)=>{console.log("info payload = topic = "+p+"payload = "+c);const d=JSON.parse(c.toString());n.addOrUpdateDevice(d.data)}),W.$on("update",(p,c)=>{console.log("update payload = topic = "+p+"payload = "+c),n.updateDeviceProperties(p,c)}),(p,c)=>{const d=z("router-link"),u=ne,_=ae,g=qe,w=K,D=He,y=z("router-view"),I=Ee,E=Ne;return m(),$(j,null,[r(E,{class:"app-wrapper"},{default:a(()=>[r(g,{collapsed:i(s).collapsed,"onUpdate:collapsed":c[0]||(c[0]=R=>i(s).collapsed=R),theme:"light",trigger:"null",class:""},{default:a(()=>[Kt,r(_,{selectedKeys:[i(e).currentRoute.value.path],theme:"light",mode:"inline"},{default:a(()=>[r(u,{key:"/home/device"},{default:a(()=>[r(d,{to:"/home/device"}),r(i(Fe)),Bt]),_:1}),r(u,{key:"/home/update"},{default:a(()=>[r(d,{to:"/home/update"}),r(i(Pe)),Jt]),_:1}),r(u,{key:"/home/configure"},{default:a(()=>[r(d,{to:"/home/configure"}),r(i(Ae)),zt]),_:1}),r(u,{key:"/home/automation"},{default:a(()=>[r(d,{to:"/home/automation"}),r(i(Re)),Wt]),_:1}),r(u,{key:"/home/help"},{default:a(()=>[r(d,{to:"/home/help"}),r(i(Te)),Vt]),_:1})]),_:1},8,["selectedKeys"])]),_:1},8,["collapsed"]),r(E,null,{default:a(()=>[r(D,{class:"app-header"},{default:a(()=>[r(w,{justify:"end",align:"middle"},{default:a(()=>[r(Ht)]),_:1})]),_:1}),r(I,{class:"app-content"},{default:a(()=>[r(y)]),_:1})]),_:1})]),_:1}),r(jt,{ref_key:"mqttConnection",ref:o},null,512)],64)}}});var Zt=P(Qt,[["__scopeId","data-v-2fd68a76"]]);const Gt=[{path:"/",redirect:"/home/device",name:"default"},{path:"/login",name:"Login",component:Pt},{path:"/home",name:"Home",component:Zt,redirect:"/home/device",meta:{requiresAuth:!0},children:[{path:"/home/dashboard",name:"Dashboard",component:Ot},{path:"/home/device",name:"Device",component:it},{path:"/home/update",name:"Update",component:bt},{path:"/home/configure",name:"Configure",component:kt},{path:"/home/automation",name:"Automation",component:St},{path:"/home/help",name:"Help",component:Lt}]}],ce=je({history:Ke(),routes:Gt,scrollBehavior(t,e,s){return s||{top:0}}});ce.beforeEach((t,e,s)=>{const o=localStorage.getItem("accessToken")||"";t.matched.some(n=>n.meta.requiresAuth)?(console.log("token= "+o),o?s():s("/login")):s()});const le=Be(Ze);le.config.globalProperties={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0};const de=Je();de.use(ze);le.use(ce).use(de).mount("#app");
