var xe=Object.defineProperty;var Ae=(t,e,o)=>e in t?xe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var D=(t,e,o)=>(Ae(t,typeof e!="symbol"?e+"":e,o),o);import{c as _,r as ae,o as u,a as ue,m as R,d as ie,b as $,e as M,f as z,g as N,h as b,u as l,w as c,i as h,j as g,F,_ as oe,k as j,M as se,l as O,t as x,E as ge,n as S,p as Q,q as W,s as X,v as q,x as T,B as V,I as le,y as Oe,z as Ie,U as Ce,P as $e,A as De,S as Re,C as Ue,D as Y,G as re,H as Pe,J as Me,L as Ke,K as Ee,N as Fe,O as Ne,Q as je,R as qe,T as fe,V as me,W as Te,X as Be,Y as He,Z as ze,$ as Je,a0 as Qe,a1 as We,a2 as Ve,a3 as Ze,a4 as Ge,a5 as Xe,a6 as Ye,a7 as et,a8 as tt,a9 as ot,aa as st,ab as nt,ac as at,ad as it}from"./vendor.2583f935.js";const lt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const m of n)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function o(n){const m={};return n.integrity&&(m.integrity=n.integrity),n.referrerpolicy&&(m.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?m.credentials="include":n.crossorigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function r(n){if(n.ep)return;n.ep=!0;const m=o(n);fetch(n.href,m)}};lt();var P=(t,e)=>{const o=t.__vccOpts||t;for(const[r,n]of e)o[r]=n;return o};const rt={};function ct(t,e){const o=ae("router-view");return u(),_(o)}var dt=P(rt,[["render",ct]]);const ut={Accept:"application/json","Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"},pt=t=>{const e=localStorage.getItem("accessToken");if(e!=null){if(t.headers===void 0)return t;t.headers.Authorization=`Bearer ${e}`}return t};class gt{constructor(){D(this,"instance",null)}get http(){return this.instance!=null?this.instance:this.initHttp()}isNetworkError(e){return!!e.isAxiosError&&!e.response}initHttp(){console.log("http base url= "+{}.VITE_APP_BASE_API);const e=ue.create({baseURL:{}.VITE_APP_BASE_API,headers:ut});return e.interceptors.request.use(pt,o=>Promise.reject(o)),e.interceptors.response.use(o=>{if(o.headers&&o.headers.authorization){const r=o.headers.authorization.split(" ")[1];localStorage.setItem("accessToken",r)}return o},o=>{if(this.isNetworkError(o))R.error("Network error");else{const{response:r}=o;return this.handleError(r)}}),this.instance=e,e}request(e){return this.http.request(e)}get(e,o){return this.http.get(e,o)}post(e,o,r){return this.http.post(e,o,r)}put(e,o,r){return this.http.put(e,o,r)}delete(e,o){return this.http.delete(e,o)}handleError(e){console.log("show server error"),console.error(e);const{status:o}=e;switch(console.error("response status= "+o),ue.isAxiosError(e)?console.error("is axios error "+e):console.error("no axios error"+e),o){case 500:{console.log(e.data.message),e.data.message?R.error(e.data.message):R.error(`Internal server error(${o})`);break}case 403:{R.error(`Forbidden(${o})`);break}case 401:{R.error(`Unauthorized(${o})`);break}case 404:{R.error(`Not found(${o})`);break}case 429:{R.error(`Too many requests error(${o})`);break}case 503:{R.error(`Service unavailable(${o})`);break}default:R.error(`Unknown error(${o})`);break}return Promise.reject(e)}}const B=new gt,ft=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]},{title:"Identify",key:"identify",dataIndex:"identify"}],Z=t=>{let e="Unknown";switch(t){case 1:e="Uncommissioned";break;case 2:e="Bootloader";break;case 3:e="Upgrading";break;case 4:e="Pairing";break;case 5:e="Commissioning";break;case 6:e="Joined";break;case 7:e="Orphan";break;case 8:e="Leaving";break}return e},_e=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]}],mt=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]},{title:"Progress",key:"progress",dataIndex:"progress"}],J=async()=>{const t=[];try{(await B.get("/api/1/devices")).data.data.forEach(function(o){t.push({key:o.mac,name:o.name+`

`+o.ip,ip:o.ip,mac:o.mac,label:o.label,swversion:o.swversion,hwversion:o.hwversion,configured:o.configured,connected:o.connected,state:o.state,identify:o.mac,isSelect:!1,progress:0})})}catch(e){console.error("fetchDevices error= "+e)}return t},he=[{title:"COM Number",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"SW Version",key:"swversion",dataIndex:"swversion",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.swversion.indexOf(t)===0,sorter:(t,e)=>t.swversion.length-e.swversion.length,sortDirections:["descend","ascend"]},{title:"Configured Status",key:"configured",dataIndex:"configured",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]},{title:"Working mode",key:"state",dataIndex:"state",filters:[],filterMultiple:!1,sorter:(t,e)=>t.state-e.state,sortDirections:["descend","ascend"]}],_t=async t=>{try{return(await B.put(`/api/1/devices/${t}`,{command:"identify"})).data}catch(e){return console.error("identifyDevice error= "+e),null}},ht=async(t,e)=>{try{return(await B.put(`/api/1/devices/${t}`,{command:"label",payload:{data:e}})).data}catch(o){return console.error("update device label error= "+o),null}};function ee(t,e){t!==null&&(t.code===0&&e?R.success(e):R.error(t.message))}function ye(t,e){const o=t.split("/"),r=o[o.length-e];return console.log("mac= "+r),r}const K=ie("devices",{state:()=>({deviceList:[],upgradeMac:[],selectFirmware:""}),getters:{allDevices(t){return t.deviceList},selectedDevices(t){return t.deviceList.filter(e=>e.isSelect)},getUpgradeMac(t){return t.upgradeMac},selectedFirmware(t){return t.selectFirmware}},actions:{addUpgradeMac(t){this.upgradeMac=t},deleteUpgradeMac(){this.upgradeMac=[]},addSelectFirmware(t){this.selectFirmware=t},deleteSelectFirmware(){this.selectFirmware=""},addDevices(t){this.deviceList=t},addDevice(t){if(this.deviceList.find(o=>o.mac===t.mac)){this.updateDevice(t);return}this.deviceList.push({key:t.mac,name:t.name+`

`+t.ip,ip:t.ip,mac:t.mac,label:t.label,swversion:t.swversion,hwversion:t.hwversion,configured:t.configured,connected:t.connected,state:t.state,identify:t.mac,isSelect:!1,progress:0})},updateDevice(t){const e=this.deviceList.findIndex(o=>o.mac===t.mac);e!==-1&&(this.deviceList[e].configured=t.configured,this.deviceList[e].connected=t.connected,this.deviceList[e].hwversion=t.hwversion,this.deviceList[e].label=t.label,this.deviceList[e].mac=t.mac,this.deviceList[e].name=t.name,this.deviceList[e].ip=t.ip,this.deviceList[e].state=t.state,this.deviceList[e].swversion=t.swversion)},updateDeviceProperties(t,e){const o=ye(t,2),r=this.deviceList.findIndex(m=>m.mac===o);if(r===-1)return;const n=JSON.parse(e.toString());console.log(n),n.hasOwnProperty("data")&&n.data.hasOwnProperty("connected")&&(this.deviceList[r].connected=n.data.connected,console.log("update device connected")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("configured")&&(this.deviceList[r].configured=n.data.configured,console.log("update device configured")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("state")&&(this.deviceList[r].state=n.data.state,console.log("update device state")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("swversion")&&(this.deviceList[r].swversion=n.data.swversion,console.log("update device swversion")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("hwversion")&&(this.deviceList[r].hwversion=n.data.hwversion,console.log("update device hwversion")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("label")&&(this.deviceList[r].label=n.data.label,console.log("update device label")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("name")&&(this.deviceList[r].name=n.data.name,console.log("update device name")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("ip")&&(this.deviceList[r].ip=n.data.ip,console.log("update device ip")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("process")&&(this.deviceList[r].progress=n.data.process,console.log("update device process"))},deleteAllDevice(){this.deviceList=[]},resetAllDeviceProgress(){this.deviceList.forEach(t=>{t.progress=0})},deleteDevice(t){const e=this.deviceList.findIndex(o=>o.mac===t);e!==-1&&this.deviceList.splice(e,1)}}});const yt=t=>(Q("data-v-b9c08f52"),t=t(),W(),t),vt=yt(()=>O("span",null," No device ",-1)),wt={key:1},bt={key:2},kt={key:3},St={key:4},Lt=S(" Identify "),xt=$({setup(t){const e=M({loading:!1,labelInput:"",showUpdateModal:!1,labelPlaceholder:"Please input label",currentDevice:void 0}),o=K(),r=(s,a,i)=>{console.log("params",s,a,i)};let n=z(new Map);const m=s=>{e.labelInput=s.label,e.currentDevice=s,e.showUpdateModal=!0},v=async s=>{var d,f;const a=await ht((d=e.currentDevice)==null?void 0:d.mac,e.labelInput);ee(a,`update device [mac=${(f=e.currentDevice)==null?void 0:f.mac}] label success!`);const i=await J();o.addDevices(i),e.showUpdateModal=!1},y=async s=>{n.value.set(s,!0);const a=await _t(s);ee(a,`Identify device [mac=${s}] success!`),(a==null?void 0:a.code)===0?setTimeout(()=>{n.value.set(s,!1)},5e3):n.value.set(s,!1)};return N(async()=>{e.loading=!0,console.log(o.deviceList);const s=await J();o.addDevices(s),e.loading=!1}),(s,a)=>{const i=oe,d=X,f=q,p=T,k=V,L=j,w=le,A=se;return u(),b(F,null,[l(o).deviceList.length===0?(u(),_(i,{key:0,class:"device-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[vt]),_:1})):h("",!0),l(o).deviceList.length!==0?(u(),_(L,{key:1,class:"device-list",columns:l(ft),"data-source":l(o).deviceList,loading:l(e).loading,pagination:!1,bordered:"",onChange:r},{bodyCell:c(({column:I,record:C})=>[I.key==="label"?(u(),_(f,{key:0,align:"middle"},{default:c(()=>[g(d,{span:22},{default:c(()=>[O("p",null,[O("span",null,x(C.label),1)])]),_:2},1024),g(d,{span:2,style:{"padding-left":"4px"}},{default:c(()=>[g(l(ge),{onClick:U=>m(C)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)):h("",!0),I.key==="configured"?(u(),b("span",wt,[(u(),_(p,{key:C.configured,color:C.configured?"green":"volcano"},{default:c(()=>[S(x(C.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),I.key==="connected"?(u(),b("span",bt,[(u(),_(p,{key:C.connected,color:C.connected?"green":"volcano"},{default:c(()=>[S(x(C.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),I.key==="state"?(u(),b("span",kt,[(u(),_(p,{key:C.state,color:C.state===1?"green":C.state===0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(C.state)),1)]),_:2},1032,["color"]))])):h("",!0),I.key==="identify"?(u(),b("span",St,[g(k,{key:"identify",class:"device-identify-button",type:"primary",shape:"round",loading:l(n).get(C.identify),onClick:U=>y(C.identify)},{default:c(()=>[Lt]),_:2},1032,["loading","onClick"])])):h("",!0)]),_:1},8,["columns","data-source","loading"])):h("",!0),g(A,{visible:l(e).showUpdateModal,"onUpdate:visible":a[2]||(a[2]=I=>l(e).showUpdateModal=I),width:"35vh",title:"Update label",onOk:v},{default:c(()=>[g(w,{value:l(e).labelInput,"onUpdate:value":a[0]||(a[0]=I=>l(e).labelInput=I),placeholder:l(e).labelPlaceholder,"onUpdate:placeholder":a[1]||(a[1]=I=>l(e).labelPlaceholder=I)},null,8,["value","placeholder"])]),_:1},8,["visible"])],64)}}});var At=P(xt,[["__scopeId","data-v-b9c08f52"]]);const Ot={key:0},It={key:1},Ct={key:2},$t=$({emits:["selectDevices"],setup(t,{expose:e,emit:o}){const r=M({selectedRowKeys:[],loading:!1,visible:!1}),n=K(),m=s=>{console.log("selectedRowKeys changed: ",s),r.selectedRowKeys=s},v=()=>{};return N(async()=>{r.loading=!0;const s=await J();n.addDevices(s),n.selectedDevices.length>0&&n.selectedDevices.filter(a=>a.isSelect).forEach(a=>r.selectedRowKeys.push(a.mac)),r.loading=!1}),e({showOrHideModal:s=>{r.visible=s}}),(s,a)=>{const i=T,d=j,f=se;return u(),_(f,{visible:l(r).visible,"onUpdate:visible":a[0]||(a[0]=p=>l(r).visible=p),title:"Select Device",width:"100%","wrap-class-name":"full-modal",onOk:v},{default:c(()=>[g(d,{columns:l(_e),"data-source":l(n).deviceList,"row-selection":{selectedRowKeys:l(r).selectedRowKeys,onChange:m},loading:l(r).loading,pagination:!1,bordered:""},{bodyCell:c(({column:p,record:k})=>[p.key==="configured"?(u(),b("span",Ot,[(u(),_(i,{key:k.configured,color:k.configured?"green":"volcano"},{default:c(()=>[S(x(k.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),p.key==="connected"?(u(),b("span",It,[(u(),_(i,{key:k.connected,color:k.connected?"green":"volcano"},{default:c(()=>[S(x(k.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),p.key==="state"?(u(),b("span",Ct,[(u(),_(i,{key:k.state,color:k.state===1?"green":k.state==0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(k.state)),1)]),_:2},1032,["color"]))])):h("",!0)]),_:1},8,["columns","data-source","row-selection","loading"])]),_:1},8,["visible"])}}}),pe=async()=>{const t=[];try{const e=await B.get("/api/1/firmwares");if(e.data.data.length===0)return t;e.data.data.forEach(function(o){t.push({key:o,name:o})})}catch(e){console.error("fetchFirmwares error= "+e)}return t},Dt=async(t,e)=>{try{return(await B.put("/api/1/firmwares",{filename:t,devices:e})).data}catch(o){console.error("updateFirmware error= "+o)}return null},Rt={class:"ant-upload-drag-icon"},Ut=O("p",{class:"ant-upload-text"},"Click or drag file to this area to upload",-1),Pt=O("p",{class:"ant-upload-hint"}," Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files ",-1),Mt=$({emits:["upload"],setup(t,{expose:e,emit:o}){const r=z([]);let n=z(!1);const m=y=>{const s=y.file.status;console.log("upload status "+s),s!=="uploading"&&console.log(y.file,y.fileList),s==="done"?(console.log("upload success"),o.call(this,"upload",!0)):s==="error"&&console.error("upload error")},v=y=>{n.value=y};return e({showOrHideModal:v}),(y,s)=>{const a=Ce,i=se;return u(),_(i,{visible:l(n),"onUpdate:visible":s[1]||(s[1]=d=>Ie(n)?n.value=d:n=d),title:"Select Firmware to upload",width:"40%",onOk:s[2]||(s[2]=d=>v(!1))},{default:c(()=>[g(a,{fileList:r.value,"onUpdate:fileList":s[0]||(s[0]=d=>r.value=d),name:"file",multiple:!0,action:"/api/1/firmwares",onChange:m},{default:c(()=>[O("p",Rt,[g(l(Oe))]),Ut,Pt]),_:1},8,["fileList"])]),_:1},8,["visible"])}}});const Kt=$({setup(t){const e=[{title:"name",dataIndex:"name"}],o=M({selectedRowKeys:[],loading:!1,data:[]}),r=z(),n=()=>{var s;(s=r.value)==null||s.showOrHideModal(!0)},m=s=>{o.selectedRowKeys=s,y.addSelectFirmware(s[0])},v=async()=>{const s=await pe();o.loading=!1,o.data=s},y=K();return N(async()=>{const s=await pe();o.loading=!1,o.data=s,o.selectedRowKeys.push(y.selectFirmware)}),(s,a)=>{const i=V,d=q,f=j;return u(),b(F,null,[g(d,{justify:"end",class:"update-firmware-list-container"},{default:c(()=>[g(i,{type:"primary",class:"update-firmware-list-add-button",onClick:n},{default:c(()=>[g(l($e))]),_:1})]),_:1}),g(f,{"row-selection":{selectedRowKeys:l(o).selectedRowKeys,type:"radio",onChange:m},columns:e,"show-header":!1,"data-source":l(o).data,loading:l(o).loading,pagination:!1},null,8,["row-selection","data-source","loading"]),g(Mt,{ref_key:"showUploadFirmware",ref:r,onUpload:v},null,512)],64)}}});var Et=P(Kt,[["__scopeId","data-v-55a269a8"]]);const Ft={key:0},Nt={key:1},jt={key:2},qt=$({setup(t){const e=M({selectedRowKeys:[],loading:!1,currentItem:"",ipList:[]}),o=K(),r=m=>{e.selectedRowKeys=m,o.addUpgradeMac(m)},n=m=>({disabled:m.state===3||!m.connected});return N(async()=>{e.loading=!0;const m=await J();o.addDevices(m),e.loading=!1}),(m,v)=>{const y=T,s=j;return u(),_(s,{"row-selection":{selectedRowKeys:l(e).selectedRowKeys,getCheckboxProps:n,onChange:r},columns:l(_e),"show-header":!0,"data-source":l(o).deviceList,loading:l(e).loading,pagination:!1},{bodyCell:c(({column:a,record:i})=>[a.key==="configured"?(u(),b("span",Ft,[(u(),_(y,{key:i.configured,color:i.configured?"green":"volcano"},{default:c(()=>[S(x(i.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),a.key==="connected"?(u(),b("span",Nt,[(u(),_(y,{key:i.connected,color:i.connected?"green":"volcano"},{default:c(()=>[S(x(i.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),a.key==="state"?(u(),b("span",jt,[(u(),_(y,{key:i.state,color:i.state===1?"green":i.state===0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(i.state)),1)]),_:2},1032,["color"]))])):h("",!0)]),_:1},8,["row-selection","columns","data-source","loading"])}}});const Tt={key:0},Bt={key:1},Ht={key:2},zt=$({emits:["start-upgrade","reset-upgrade"],setup(t,{expose:e,emit:o}){const r=M({selectedRowKeys:[],loading:!1,data:[],startUpgrade:!1,startText:"Start",finish:!1}),n=K(),m=()=>{if(r.finish){console.log("back to device"),o.call(this,"reset-upgrade");return}r.startUpgrade=!0,r.startText="Starting",o.call(this,"start-upgrade")};return e({resetProgress:()=>{r.startUpgrade=!1,r.startText="Back",r.finish=!0}}),(y,s)=>{const a=T,i=De,d=j,f=X,p=V,k=q;return u(),_(k,{justify:"center"},{default:c(()=>[g(f,{span:24,class:"update-progress-list-container"},{default:c(()=>[g(d,{columns:l(mt),"show-header":!0,"data-source":l(n).deviceList.filter(L=>l(n).upgradeMac.indexOf(L.mac)!==-1),loading:l(r).loading,pagination:!1},{bodyCell:c(({column:L,record:w})=>[L.key==="configured"?(u(),b("span",Tt,[(u(),_(a,{key:w.configured,color:w.configured?"green":"volcano"},{default:c(()=>[S(x(w.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),L.key==="connected"?(u(),b("span",Bt,[(u(),_(a,{key:w.connected,color:w.connected?"green":"volcano"},{default:c(()=>[S(x(w.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),L.key==="state"?(u(),b("span",Ht,[(u(),_(a,{key:w.state,color:w.state===1?"green":w.state===0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(w.state)),1)]),_:2},1032,["color"]))])):h("",!0),L.key==="progress"?(u(),_(i,{key:3,percent:w.progress,size:"small"},null,8,["percent"])):h("",!0)]),_:1},8,["columns","data-source","loading"])]),_:1}),g(p,{class:"update-progress-list-start-button",type:"primary",loading:l(r).startUpgrade,size:"large",shape:"round",onClick:m},{default:c(()=>[S(x(l(r).startText),1)]),_:1},8,["loading"])]),_:1})}}});var Jt=P(zt,[["__scopeId","data-v-0272c9da"]]);const Qt={class:"update-steps-menu-button-container"},Wt=S(" Previous"),Vt=S(" Next"),Zt=$({setup(t){const e=M({selectedRowKeys:[],loading:!1,data:[],showUploadFirmware:null,currentStep:0}),o=z(),r=K(),n=()=>{e.currentStep!==0&&e.currentStep--},m=()=>{if(console.log("click select step= "+e.currentStep),e.currentStep===0&&r.selectFirmware===""){R.warn("Please select firmware firstly.");return}if(e.currentStep===1&&r.getUpgradeMac.length===0){R.warn("Please select devices which you want to upgrade.");return}e.currentStep++},v=async()=>{var a;const s=await Dt(r.selectFirmware,r.getUpgradeMac);ee(s,"Upgrade has started!"),(a=o.value)==null||a.resetProgress()},y=()=>{e.currentStep=0,r.resetAllDeviceProgress(),r.deleteUpgradeMac(),r.deleteSelectFirmware()};return(s,a)=>{const i=Re,d=Ue,f=X,p=q,k=V;return u(),b(F,null,[g(p,{class:"upgrade-steps",justify:"center"},{default:c(()=>[g(f,{span:24},{default:c(()=>[g(d,{current:l(e).currentStep,direction:"horizontal"},{default:c(()=>[g(i,{title:"Select firmware",description:"Select which version to upgrade."}),g(i,{title:"Select device",description:"Select devices to upgrade."}),g(i,{title:"Upgrade",description:"Confirm to upgrade."})]),_:1},8,["current"])]),_:1})]),_:1}),g(p,{class:"update-steps-content",justify:"center"},{default:c(()=>[l(e).currentStep===0?(u(),_(f,{key:0,span:24},{default:c(()=>[g(Et)]),_:1})):h("",!0),l(e).currentStep===1?(u(),_(f,{key:1,span:24},{default:c(()=>[g(qt)]),_:1})):h("",!0),l(e).currentStep===2?(u(),_(f,{key:2,span:24},{default:c(()=>[g(Jt,{ref_key:"upgradeProgressTable",ref:o,onStartUpgrade:v,onResetUpgrade:y},null,512)]),_:1})):h("",!0)]),_:1}),g(p,{justify:"center",class:"update-step-menu"},{default:c(()=>[O("div",Qt,[l(e).currentStep>0&&l(e).currentStep<2?(u(),_(k,{key:0,class:"update-steps-menu-pre-button",type:"primary",size:"large",shape:"round",style:{"margin-right":"50px","margin-top":"20px",width:"120px"},onClick:n},{default:c(()=>[Wt]),_:1})):h("",!0),l(e).currentStep<2?(u(),_(k,{key:1,class:"update-steps-menu-next-button",type:"primary",size:"large",shape:"round",onClick:m},{default:c(()=>[Vt]),_:1})):h("",!0)])]),_:1}),g($t,{ref:"showModalRef"},null,512)],64)}}});var Gt=P(Zt,[["__scopeId","data-v-27508ce4"]]);const ce=[{title:"Name",key:"name",dataIndex:"name",filters:[],onFilter:(t,e)=>e.name.indexOf(t)===0,sorter:(t,e)=>t.name.length-e.name.length,sortDirections:["descend","ascend"]},{title:"MAC Address",key:"mac",dataIndex:"mac",sortDirections:["descend","ascend"],sorter:(t,e)=>t.mac.length-e.mac.length},{title:"Label",key:"label",dataIndex:"label",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.label.indexOf(t)===0,sorter:(t,e)=>t.label.length-e.label.length,sortDirections:["descend","ascend"]},{title:"Version",key:"version",dataIndex:"version",filters:[],filterMultiple:!1,onFilter:(t,e)=>e.version.indexOf(t)===0,sorter:(t,e)=>t.version.length-e.version.length,sortDirections:["descend","ascend"]},{title:"Connected",key:"connected",dataIndex:"connected",filters:[],filterMultiple:!1,sortDirections:["descend","ascend"]}],te=async()=>{const t=[];try{(await B.get("/api/1/simulators")).data.data.forEach(function(o){t.push({key:o.mac,name:o.name,ip:o.ip,mac:o.mac,label:o.label,version:o.version,connected:o.connected,isSelect:!1})})}catch(e){console.error("fetchDevices error= "+e),e&&console.log(e.status)}return t},Xt=async(t,e)=>{try{return(await B.put(`/api/1/simulators/${t}`,{command:"label",payload:{data:e}})).data}catch(o){return console.error("update simulator label error= "+o),null}},ne=ie("simulators",{state:()=>({simulatorList:[]}),persist:{enabled:!0,strategies:[{key:"simulators",storage:localStorage,paths:["simulators"]}]},getters:{allSimulators(t){return t.simulatorList},selectedSimulators(t){return t.simulatorList.filter(e=>e.isSelect)}},actions:{updateSimulatorProperties(t,e){const o=ye(t,3),r=this.simulatorList.findIndex(m=>m.mac===o);if(r===-1)return;const n=JSON.parse(e.toString());console.log(n),n.hasOwnProperty("data")&&n.data.hasOwnProperty("connected")&&(this.simulatorList[r].connected=n.data.connected,console.log("update simulator connected")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("version")&&(this.simulatorList[r].version=n.data.version,console.log("update simulator version")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("label")&&(this.simulatorList[r].label=n.data.label,console.log("update simulator label")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("name")&&(this.simulatorList[r].name=n.data.name,console.log("update simulator name")),n.hasOwnProperty("data")&&n.data.hasOwnProperty("ip")&&(this.simulatorList[r].ip=n.data.ip,console.log("update simulator ip"))},delete(t){!t||this.simulatorList.forEach((e,o)=>{e.mac===t.mac&&this.simulatorList.splice(o,1)})},deleteAllSimulators(){this.simulatorList=[]},addSimulators(t){this.simulatorList=t},addSimulator(t){if(this.selectedSimulators.find(o=>o.mac===t.mac)){this.updateDevice(t);return}this.selectedSimulators.push({key:t.mac,name:t.name+`

`+t.ip,ip:t.ip,mac:t.mac,label:t.label,version:t.version,connected:t.connected,isSelect:!1})},updateDevice(t){const e=this.selectedSimulators.findIndex(o=>o.mac===t.mac);e!==-1&&(this.selectedSimulators[e].connected=t.connected,this.selectedSimulators[e].label=t.label,this.selectedSimulators[e].mac=t.mac,this.selectedSimulators[e].name=t.name,this.selectedSimulators[e].ip=t.ip,this.selectedSimulators[e].version=t.version)}}});const ve=t=>(Q("data-v-c3617a4c"),t=t(),W(),t),Yt=ve(()=>O("span",null," No Simulator and device ",-1)),eo={key:0},to=ve(()=>O("span",null," No device ",-1)),oo={key:0},so={key:1},no={key:2},ao=$({setup(t){const e=M({selectedRowKeys:[],childSelectRowKeys:[],loading:!1,visible:!1,groupList:[],childList:new Map}),o=K(),r=ne(),n=Y(()=>({onChange:(s,a)=>{console.log(`group selectedRowKeys: ${s}`,"selectedRows: ",a),e.selectedRowKeys=s},onSelect:(s,a,i)=>{console.log("group select"),console.log(s,a,i);const d=e.childList.get(s.ip);a?(d&&d.forEach(f=>{e.childSelectRowKeys.indexOf(f.ip)===-1&&e.childSelectRowKeys.push(f.mac)}),s.indeterminate=!1,e.groupList=[...e.groupList]):(d&&(console.log("remove child "+s.ip),console.log(d),d.forEach(f=>{const p=e.childSelectRowKeys.indexOf(f.mac);e.childSelectRowKeys.splice(p,1)})),s.indeterminate=!1,e.groupList=[...e.groupList])},onSelectAll:(s,a,i)=>{console.log("group select all"),console.log(s,a,i),s?m(s,a):e.childSelectRowKeys=[]},selectedRowKeys:e.selectedRowKeys,getCheckboxProps:s=>{var a;return console.log("getCheckboxProps"),{disabled:!s.connected||((a=e.childList.get(s.ip))==null?void 0:a.length)===0,indeterminate:s.indeterminate}}})),m=(s,a)=>{a.forEach(function(i){const d=e.childList.get(i.ip);d&&d.forEach((f,p)=>{s?e.childSelectRowKeys.indexOf(f.ip)===-1&&e.childSelectRowKeys.push(f.mac):e.childSelectRowKeys.splice(p,1)})})},v=Y(()=>({onChange:(s,a)=>{console.log(`child selectedRowKeys: ${s}`,"selectedRows: ",a),e.childSelectRowKeys=s},onSelect:(s,a,i)=>{var d;if(console.log("child select"),console.log(s,a,i),i.length===0){const f=e.selectedRowKeys.indexOf(s.ip);e.selectedRowKeys.splice(f,1),console.log("child select indeterminate false ip= "+s.ip);const p=e.groupList.find(k=>k.ip===s.ip);p&&(console.log("indeterminate false groupItem= "+!1),p.indeterminate=!1,e.groupList=[...e.groupList])}else if(i.length===((d=e.childList.get(s.ip))==null?void 0:d.length)){e.selectedRowKeys.indexOf(s.ip)===-1&&e.selectedRowKeys.push(s.ip);const f=e.groupList.find(p=>p.ip===s.ip);f&&(console.log("child select indeterminate false ip= "+s.ip),f.indeterminate=!1,e.groupList=[...e.groupList])}else{console.log("child select indeterminate true ip= "+s.ip);const f=e.groupList.find(p=>p.ip===s.ip);f&&(console.log("indeterminate false groupItem= "+!0),f.indeterminate=!0,e.groupList=[...e.groupList])}},onSelectAll:(s,a,i)=>{if(console.log("child select all"),console.log(s,a,i),console.log("state= "+e.childSelectRowKeys),s){e.selectedRowKeys.indexOf(a[0].ip)===-1&&e.selectedRowKeys.push(a[0].ip);const d=e.groupList.find(f=>f.ip===a[0].ip);d&&(d.indeterminate=!1,e.groupList=[...e.groupList])}else{const d=e.selectedRowKeys.indexOf(i[0].ip);e.selectedRowKeys.splice(d,1);const f=e.groupList.find(p=>p.ip===i[0].ip);f&&(f.indeterminate=!1,e.groupList=[...e.groupList])}},getCheckboxProps:s=>(console.log("getCheckboxProps"),{disabled:!s.connected}),selectedRowKeys:e.childSelectRowKeys})),y=(s,a)=>{console.log("expandChild")};return N(async()=>{e.loading=!0;const s=await te();r.addSimulators(s);const a=await J();o.addDevices(a),s.forEach(i=>{e.groupList.push({key:i.mac,ip:i.ip,name:i.name,mac:i.mac,label:i.label,version:i.version,connected:i.connected,indeterminate:!1})}),r.simulatorList.forEach(i=>{const d=o.deviceList.filter(p=>p.ip===i.ip);console.log("ip= "+i.ip),console.log(d);const f=[];d.forEach(function(p){f.push({key:p.mac,name:p.name,ip:p.ip,mac:p.mac,label:p.label,swversion:p.swversion,hwversion:p.hwversion,configured:p.configured,connected:p.connected,state:p.state})}),e.childList.set(i.ip,f)}),e.loading=!1}),(s,a)=>{const i=oe,d=T,f=j;return u(),b(F,null,[l(r).simulatorList.length===0?(u(),_(i,{key:0,class:"configure-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[Yt]),_:1})):h("",!0),l(r).simulatorList.length!==0?(u(),_(f,{key:1,class:"configure-list-container",columns:l(ce),"data-source":l(e).groupList,"row-selection":l(n),pagination:!1,bordered:"",onExpand:y},{bodyCell:c(({column:p,record:k})=>[p.key==="connected"?(u(),b("span",eo,[(u(),_(d,{key:k.connected,color:k.connected?"green":"volcano"},{default:c(()=>[S(x(k.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0)]),expandedRowRender:c(({index:p})=>{var k,L;return[((k=l(e).childList.get(l(e).groupList[p].ip))==null?void 0:k.length)===0?(u(),_(i,{key:0,class:"device-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[to]),_:1})):h("",!0),((L=l(e).childList.get(l(e).groupList[p].ip))==null?void 0:L.length)!==0?(u(),_(f,{key:1,columns:l(he),"data-source":l(e).childList.get(l(e).groupList[p].ip),"row-selection":l(v),bordered:"",pagination:!1},{bodyCell:c(({column:w,record:A})=>[w.key==="configured"?(u(),b("span",oo,[(u(),_(d,{key:A.configured,color:A.configured?"green":"volcano"},{default:c(()=>[S(x(A.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),w.key==="connected"?(u(),b("span",so,[(u(),_(d,{key:A.connected,color:A.connected?"green":"volcano"},{default:c(()=>[S(x(A.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),w.key==="state"?(u(),b("span",no,[(u(),_(d,{key:A.state,color:A.state===1?"green":A.state===0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(A.state)),1)]),_:2},1032,["color"]))])):h("",!0)]),_:2},1032,["columns","data-source","row-selection"])):h("",!0)]}),_:1},8,["columns","data-source","row-selection"])):h("",!0)],64)}}});var io=P(ao,[["__scopeId","data-v-c3617a4c"]]);const lo=$({setup(t){return(e,o)=>(u(),b("div",null,"Log"))}}),ro={};function co(t,e){return u(),b("div",null,"Help")}var uo=P(ro,[["render",co]]);const po=$({setup(){console.log("dashboard")}});function go(t,e,o,r,n,m){return u(),b("div",null,"Dashboard")}var fo=P(po,[["render",go]]);const de=ie("user",{state:()=>({user:{userName:"",password:""}}),persist:{enabled:!0,strategies:[{key:"currentUser",storage:localStorage}]},getters:{getUser(t){return t.user}},actions:{addUser(t){this.user=t},deleteUser(){this.user={userName:"",password:""}}}});const we=t=>(Q("data-v-296854b9"),t=t(),W(),t),mo={class:"login-container"},_o=we(()=>O("h2",{class:"login-title"},"Wiser Zigbee Launcher",-1)),ho=we(()=>O("h2",{class:"title"},"Sign In",-1)),yo=S("SIGN IN"),vo=$({setup(t){const e=M({userName:"",password:"",ip:"",loginStart:!1}),o=re(),r=de(),n=i=>{console.log(i,e)},m=i=>{console.log(i)},v=()=>{e.loginStart=!0,e.userName==="admin"&&e.password==="admin"?setTimeout(()=>{localStorage.setItem("accessToken","1234567890"),r.addUser({userName:e.userName,password:e.password,ips:[e.ip],currentIP:e.ip}),o.push("/home/device"),e.loginStart=!1},500):((e.userName!=="admin"||e.password!=="admin")&&R.error("Username or password error."),e.loginStart=!1)},a={checkUserName:[{validator:async(i,d)=>{if(d==="")return Promise.reject("Please input username")},trigger:"change"}],checkPassword:[{validator:async(i,d)=>{if(d==="")return Promise.reject("Please input password")},trigger:"change"}]};return(i,d)=>{const f=le,p=Ee,k=Fe,L=V,w=Ne,A=Pe;return u(),b("div",mo,[_o,g(A,{class:"login-card"},{default:c(()=>[g(w,{model:l(e),rules:a,onFinish:n,onFinishFailed:m},{default:c(()=>[ho,g(p,null,{default:c(()=>[g(f,{value:l(e).userName,"onUpdate:value":d[0]||(d[0]=I=>l(e).userName=I),class:"inputBox",placeholder:"Username"},{prefix:c(()=>[g(l(Me),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),_:1}),g(p,null,{default:c(()=>[g(k,{value:l(e).password,"onUpdate:value":d[1]||(d[1]=I=>l(e).password=I),class:"inputBox",placeholder:"Password"},{prefix:c(()=>[g(l(Ke),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),_:1}),g(p,null,{default:c(()=>[g(L,{class:"submit",type:"primary",disabled:l(e).userName===""||l(e).password==="",loading:l(e).loginStart,onClick:v},{default:c(()=>[yo]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}});var wo=P(vo,[["__scopeId","data-v-296854b9"]]);class bo{constructor(){D(this,"subjects");this.subjects=new Map}$on(e,o){this.subjects.set(e,o)}$emit(e,o,r){this.subjects.forEach((n,m)=>{e.indexOf(m)!==-1&&n(o,r)})}}const G=new bo,ko={class:"demo-dropdown-wrap"},So=S("U"),Lo=S(" Log out "),xo=$({setup(t){const e=re(),o=K(),r=de(),n=({key:m})=>{console.log(`Click on item ${m}`),m==="logout"&&(localStorage.setItem("accessToken",""),o.deleteAllDevice(),r.deleteUser(),e.push("/login"))};return(m,v)=>{const y=qe,s=fe,a=me,i=Te;return u(),b("div",ko,[g(i,null,{overlay:c(()=>[g(a,{onClick:n},{default:c(()=>[g(s,{key:"logout"},{default:c(()=>[g(l(je)),Lo]),_:1})]),_:1})]),default:c(()=>[g(y,{style:{color:"#f56a00","background-color":"#fde3cf"}},{default:c(()=>[So]),_:1})]),_:1})])}}});var E=(t=>(t.SimulatorUpdate="v1.0/9012abcd/simulator/info",t.SimulatorInfo="v1.0/3456abcd/simulator/update",t.DongleUpdate="v1.0/1234abcd/simulator/devices/1234abcd/update",t.DongleInfo="v1.0/5678abcd/simulator/devices/5678abcd/info",t))(E||{});class Ao{constructor(e,o,r,n){D(this,"mqclient");D(this,"brokerHost");D(this,"brokerPort");D(this,"endpoint");D(this,"protocol");D(this,"subscribeTopics");D(this,"subscribeCallbacks");D(this,"dongleUpdateRegex");D(this,"dongleInfoRegex");D(this,"simulatorUpdateRegex");D(this,"simulatorInfoRegex");this.brokerHost=e,this.brokerPort=o,this.endpoint=r,this.protocol=n,this.subscribeTopics=[],this.subscribeCallbacks=new Map,this.dongleUpdateRegex=RegExp("v1.0/[.:a-zA-Z0-9]+/simulator/devices/[.:a-zA-Z0-9]+/update"),this.dongleInfoRegex=RegExp("v1.0/[.:a-zA-Z0-9]+/simulator/devices/[.:a-zA-Z0-9]+/info"),this.simulatorUpdateRegex=RegExp("v1.0/[.:a-zA-Z0-9]+/simulator/update"),this.simulatorInfoRegex=RegExp("v1.0/[.:a-zA-Z0-9]+/simulator/info")}subscribe(e,o){this.subscribeTopics.push({topic:e,qos:o}),this.is_connected()&&this.mqclient.subscribe(e,{qos:o})}set_message_callback(e,o){this.subscribeCallbacks.set(e,o)}is_connected(){return this.mqclient.connected===!0}connect(e){try{this.mqclient=Be.exports.connect(`${this.protocol}://${this.brokerHost}:${this.brokerPort}${this.endpoint}`,e)}catch(o){console.error(o)}this.mqclient.on("connect",()=>{console.log(`connect success to mqtt server[${this.brokerHost}:${this.brokerPort}]`);for(let o=0;o<this.subscribeTopics.length;o++){const r=this.subscribeTopics[o];this.mqclient.subscribe(r.topic,{qos:r.qos})}}),this.mqclient.on("message",(o,r)=>{console.log("topic= "+o),this.subscribeCallbacks.forEach((n,m)=>{(this.dongleUpdateRegex.test(o)&&this.dongleUpdateRegex.test(m)||this.dongleInfoRegex.test(o)&&this.dongleInfoRegex.test(m)||this.simulatorInfoRegex.test(o)&&this.simulatorInfoRegex.test(m)||this.simulatorUpdateRegex.test(o)&&this.simulatorUpdateRegex.test(m))&&n(m,o,r)})}),this.mqclient.on("error",()=>{console.log("connect failure to mqtt server")})}}const Oo=$({setup(t,{expose:e}){const o=(n,m,v)=>{G.$emit(n,m,v)};return e({connectMqtt:async n=>{console.log("connectMqtt");const m=new Ao(n.host,n.port,n.endpoint,n.protocol);m.connect({username:n.user,password:n.pwd,clientId:n.id,clean:n.clean,connectTimeout:n.connectTimeout,reconnectPeriod:n.reconnectPeriod}),m.subscribe("v1.0/+/simulator/devices/+/update",2),m.subscribe("v1.0/+/simulator/devices/+/info",2),m.set_message_callback(E.DongleUpdate,o.bind(this)),m.set_message_callback(E.DongleInfo,o.bind(this)),m.subscribe("v1.0/+/simulator/update",2),m.subscribe("v1.0/+/simulator/info",2),m.set_message_callback(E.SimulatorUpdate,o.bind(this)),m.set_message_callback(E.SimulatorInfo,o.bind(this))}}),(n,m)=>(u(),b("div"))}});const H=t=>(Q("data-v-4f46ce11"),t=t(),W(),t),Io=H(()=>O("div",{class:"app-logo"},"WZL",-1)),Co=H(()=>O("span",null,"Simulator",-1)),$o=H(()=>O("span",null,"Device",-1)),Do=H(()=>O("span",null,"Update",-1)),Ro=H(()=>O("span",null,"Configure",-1)),Uo=H(()=>O("span",null,"Log",-1)),Po=H(()=>O("span",null,"Help",-1)),Mo=$({setup(t){const e=re(),o=M({collapsed:!1,selectedKeys:[]}),r=z(),n=K(),m=de(),v=ne();N(()=>{var i;console.log("on mounted"),console.log("ip= "+window.location.hostname);const s="mqttx_"+Math.random().toString(16).substring(2,8);let a={host:window.location.hostname,port:8083,endpoint:"/mqtt",protocol:"ws",user:"",pwd:"",id:s,clean:!0,connectTimeout:1e4,reconnectPeriod:4e3};(i=r.value)==null||i.connectMqtt(a),window.addEventListener("beforeunload",d=>y(d))});const y=s=>{console.log("close browser"),n.resetAllDeviceProgress(),n.deleteSelectFirmware(),n.deleteUpgradeMac(),m.deleteUser()};return He(()=>{window.removeEventListener("beforeunload",s=>y())}),G.$on(E.DongleInfo,(s,a)=>{console.log("dongle info payload = topic = "+s+"payload = "+a);const i=JSON.parse(a.toString());n.addDevice(i.data)}),G.$on(E.DongleUpdate,(s,a)=>{console.log("dongle update payload = topic = "+s+"payload = "+a),n.updateDeviceProperties(s,a)}),G.$on(E.SimulatorUpdate,(s,a)=>{console.log("simulator update payload = topic = "+s+"payload = "+a),v.updateSimulatorProperties(s,a)}),G.$on(E.SimulatorInfo,(s,a)=>{console.log("simulator info payload = topic = "+s+"payload = "+a);const i=JSON.parse(a.toString());v.addSimulator(i.data)}),(s,a)=>{const i=ae("router-link"),d=fe,f=me,p=Xe,k=q,L=Ye,w=ae("router-view"),A=et,I=ze;return u(),b(F,null,[g(I,{class:"app-wrapper"},{default:c(()=>[g(p,{collapsed:l(o).collapsed,"onUpdate:collapsed":a[0]||(a[0]=C=>l(o).collapsed=C),theme:"light",trigger:"null",class:""},{default:c(()=>[Io,g(f,{"selected-keys":[l(e).currentRoute.value.path],theme:"light",mode:"inline"},{default:c(()=>[g(d,{key:"/home/simulator"},{default:c(()=>[g(i,{to:"/home/simulator"}),g(l(Je)),Co]),_:1}),g(d,{key:"/home/device"},{default:c(()=>[g(i,{to:"/home/device"}),g(l(Qe)),$o]),_:1}),g(d,{key:"/home/update"},{default:c(()=>[g(i,{to:"/home/update"}),g(l(We)),Do]),_:1}),g(d,{key:"/home/configure"},{default:c(()=>[g(i,{to:"/home/configure"}),g(l(Ve)),Ro]),_:1}),g(d,{key:"/home/automation"},{default:c(()=>[g(i,{to:"/home/automation"}),g(l(Ze)),Uo]),_:1}),g(d,{key:"/home/help"},{default:c(()=>[g(i,{to:"/home/help"}),g(l(Ge)),Po]),_:1})]),_:1},8,["selected-keys"])]),_:1},8,["collapsed"]),g(I,null,{default:c(()=>[g(L,{class:"app-header"},{default:c(()=>[g(k,{justify:"end",align:"middle"},{default:c(()=>[g(xo)]),_:1})]),_:1}),g(A,{class:"app-content"},{default:c(()=>[g(w)]),_:1})]),_:1})]),_:1}),g(Oo,{ref_key:"mqttConnection",ref:r},null,512)],64)}}});var Ko=P(Mo,[["__scopeId","data-v-4f46ce11"]]);const Eo=t=>(Q("data-v-62948459"),t=t(),W(),t),Fo=Eo(()=>O("span",null," No Simulator ",-1)),No={key:0,style:{"{{ whiteSpace":"'pre-wrapper' }}"}},jo={key:2},qo=$({setup(t){const e=M({loading:!1,labelInput:"",labelPlaceholder:"Please input label",showUpdateModal:!1,currentSimulator:void 0}),o=ne(),r=(v,y,s)=>{console.log("params",v,y,s)},n=v=>{e.labelInput=v.label,e.currentSimulator=v,e.showUpdateModal=!0},m=async v=>{var a,i;const y=await Xt((a=e.currentSimulator)==null?void 0:a.mac,e.labelInput);ee(y,`update simulator [mac=${(i=e.currentSimulator)==null?void 0:i.mac}] label success!`);const s=await te();o.addSimulators(s),e.showUpdateModal=!1};return N(async()=>{e.loading=!0,console.log(o.simulatorList);const v=await te();o.addSimulators(v),e.loading=!1}),(v,y)=>{const s=oe,a=X,i=q,d=T,f=j,p=le,k=se;return u(),b(F,null,[l(o).simulatorList.length===0?(u(),_(s,{key:0,class:"simulator-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[Fo]),_:1})):h("",!0),l(o).simulatorList.length!==0?(u(),_(f,{key:1,class:"device-list",columns:l(ce),"data-source":l(o).simulatorList,loading:l(e).loading,pagination:!1,bordered:"",onChange:r},{bodyCell:c(({column:L,record:w})=>[L.key==="name"?(u(),b("div",No,x(w.name),1)):L.key==="label"?(u(),_(i,{key:1,align:"middle"},{default:c(()=>[g(a,{span:22},{default:c(()=>[O("p",null,[O("span",null,x(w.label),1)])]),_:2},1024),g(a,{span:2,style:{"padding-left":"4px"}},{default:c(()=>[g(l(ge),{onClick:A=>n(w)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)):h("",!0),L.key==="connected"?(u(),b("span",jo,[(u(),_(d,{key:w.connected,color:w.connected?"green":"volcano"},{default:c(()=>[S(x(w.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0)]),_:1},8,["columns","data-source","loading"])):h("",!0),g(k,{visible:l(e).showUpdateModal,"onUpdate:visible":y[2]||(y[2]=L=>l(e).showUpdateModal=L),width:"35vh",title:"Update label",onOk:m},{default:c(()=>[g(p,{value:l(e).labelInput,"onUpdate:value":y[0]||(y[0]=L=>l(e).labelInput=L),placeholder:l(e).labelPlaceholder,"onUpdate:placeholder":y[1]||(y[1]=L=>l(e).labelPlaceholder=L)},null,8,["value","placeholder"])]),_:1},8,["visible"])],64)}}});var To=P(qo,[["__scopeId","data-v-62948459"]]);const be=t=>(Q("data-v-7f6c3ce0"),t=t(),W(),t),Bo=be(()=>O("span",null," No Simulator and device ",-1)),Ho={key:0},zo=be(()=>O("span",null," No device ",-1)),Jo={key:0},Qo={key:1},Wo={key:2},Vo=$({setup(t){const e=M({selectedRowKeys:[],childSelectRowKeys:[],loading:!1,visible:!1,groupList:[],childList:new Map,operatorMenu:["Join","Leave","On","Off","Join","Leave","On","Off","Join","Leave","On","Off","Join","Leave","On","Off","Join","Leave","On","Off"]}),o=K(),r=ne(),n=Y(()=>({onChange:(s,a)=>{console.log(`group selectedRowKeys: ${s}`,"selectedRows: ",a),e.selectedRowKeys=s},onSelect:(s,a,i)=>{console.log("group select"),console.log(s,a,i);const d=e.childList.get(s.ip);a?(d&&d.forEach(f=>{e.childSelectRowKeys.indexOf(f.ip)===-1&&e.childSelectRowKeys.push(f.mac)}),s.indeterminate=!1,e.groupList=[...e.groupList]):(d&&(console.log("remove child "+s.ip),console.log(d),d.forEach(f=>{const p=e.childSelectRowKeys.indexOf(f.mac);e.childSelectRowKeys.splice(p,1)})),s.indeterminate=!1,e.groupList=[...e.groupList])},onSelectAll:(s,a,i)=>{console.log("group select all"),console.log(s,a,i),s?m(s,a):e.childSelectRowKeys=[]},selectedRowKeys:e.selectedRowKeys,getCheckboxProps:s=>{var a;return console.log("getCheckboxProps"),{disabled:!s.connected||((a=e.childList.get(s.ip))==null?void 0:a.length)===0,indeterminate:s.indeterminate}}})),m=(s,a)=>{a.forEach(function(i){const d=e.childList.get(i.ip);d&&d.forEach((f,p)=>{s?e.childSelectRowKeys.indexOf(f.ip)===-1&&e.childSelectRowKeys.push(f.mac):e.childSelectRowKeys.splice(p,1)})})},v=Y(()=>({onChange:(s,a)=>{console.log(`child selectedRowKeys: ${s}`,"selectedRows: ",a),e.childSelectRowKeys=s},onSelect:(s,a,i)=>{var d;if(console.log("child select"),console.log(s,a,i),i.length===0){const f=e.selectedRowKeys.indexOf(s.ip);e.selectedRowKeys.splice(f,1),console.log("child select indeterminate false ip= "+s.ip);const p=e.groupList.find(k=>k.ip===s.ip);p&&(console.log("indeterminate false groupItem= "+!1),p.indeterminate=!1,e.groupList=[...e.groupList])}else if(i.length===((d=e.childList.get(s.ip))==null?void 0:d.length)){e.selectedRowKeys.indexOf(s.ip)===-1&&e.selectedRowKeys.push(s.ip);const f=e.groupList.find(p=>p.ip===s.ip);f&&(console.log("child select indeterminate false ip= "+s.ip),f.indeterminate=!1,e.groupList=[...e.groupList])}else{console.log("child select indeterminate true ip= "+s.ip);const f=e.groupList.find(p=>p.ip===s.ip);f&&(console.log("indeterminate false groupItem= "+!0),f.indeterminate=!0,e.groupList=[...e.groupList])}},onSelectAll:(s,a,i)=>{if(console.log("child select all"),console.log(s,a,i),console.log("state= "+e.childSelectRowKeys),s){e.selectedRowKeys.indexOf(a[0].ip)===-1&&e.selectedRowKeys.push(a[0].ip);const d=e.groupList.find(f=>f.ip===a[0].ip);d&&(d.indeterminate=!1,e.groupList=[...e.groupList])}else{const d=e.selectedRowKeys.indexOf(i[0].ip);e.selectedRowKeys.splice(d,1);const f=e.groupList.find(p=>p.ip===i[0].ip);f&&(f.indeterminate=!1,e.groupList=[...e.groupList])}},getCheckboxProps:s=>(console.log("getCheckboxProps"),{disabled:!s.connected}),selectedRowKeys:e.childSelectRowKeys})),y=(s,a)=>{console.log("expandChild")};return N(async()=>{e.loading=!0;const s=await te();r.addSimulators(s);const a=await J();o.addDevices(a),s.forEach(i=>{e.groupList.push({key:i.mac,ip:i.ip,name:i.name,mac:i.mac,label:i.label,version:i.version,connected:i.connected,indeterminate:!1})}),r.simulatorList.forEach(i=>{const d=o.deviceList.filter(p=>p.ip===i.ip);console.log("ip= "+i.ip),console.log(d);const f=[];d.forEach(function(p){f.push({key:p.mac,name:p.name,ip:p.ip,mac:p.mac,label:p.label,swversion:p.swversion,hwversion:p.hwversion,configured:p.configured,connected:p.connected,state:p.state})}),e.childList.set(i.ip,f)}),e.loading=!1}),(s,a)=>{const i=oe,d=T,f=j,p=V,k=X,L=q;return u(),b(F,null,[l(r).simulatorList.length===0?(u(),_(i,{key:0,class:"configure-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[Bo]),_:1})):h("",!0),l(r).simulatorList.length!==0?(u(),_(f,{key:1,class:"configure-list-container",columns:l(ce),"data-source":l(e).groupList,"row-selection":l(n),pagination:!1,scroll:{y:`calc(${47+"vh"})`},bordered:"",onExpand:y},{bodyCell:c(({column:w,record:A})=>[w.key==="connected"?(u(),b("span",Ho,[(u(),_(d,{key:A.connected,color:A.connected?"green":"volcano"},{default:c(()=>[S(x(A.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0)]),expandedRowRender:c(({index:w})=>{var A,I;return[((A=l(e).childList.get(l(e).groupList[w].ip))==null?void 0:A.length)===0?(u(),_(i,{key:0,class:"device-empty-container",image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original"},{bodyCell:c(()=>[zo]),_:1})):h("",!0),((I=l(e).childList.get(l(e).groupList[w].ip))==null?void 0:I.length)!==0?(u(),_(f,{key:1,columns:l(he),"data-source":l(e).childList.get(l(e).groupList[w].ip),"row-selection":l(v),bordered:"",pagination:!1},{bodyCell:c(({column:C,record:U})=>[C.key==="configured"?(u(),b("span",Jo,[(u(),_(d,{key:U.configured,color:U.configured?"green":"volcano"},{default:c(()=>[S(x(U.configured?"Configured":"No Configure"),1)]),_:2},1032,["color"]))])):h("",!0),C.key==="connected"?(u(),b("span",Qo,[(u(),_(d,{key:U.connected,color:U.connected?"green":"volcano"},{default:c(()=>[S(x(U.connected?"Online":"Offline"),1)]),_:2},1032,["color"]))])):h("",!0),C.key==="state"?(u(),b("span",Wo,[(u(),_(d,{key:U.state,color:U.state===1?"green":U.state===0?"volcano":"geekblue"},{default:c(()=>[S(x(l(Z)(U.state)),1)]),_:2},1032,["color"]))])):h("",!0)]),_:2},1032,["columns","data-source","row-selection"])):h("",!0)]}),_:1},8,["columns","data-source","row-selection","scroll"])):h("",!0),g(L,{justify:"center",class:"operator-container"},{default:c(()=>[g(L,{gutter:[24,8]},{default:c(()=>[(u(!0),b(F,null,tt(l(e).operatorMenu,w=>(u(),_(k,{key:w.toString(),span:6},{default:c(()=>[g(p,{type:"primary",size:"large",shape:"round",block:""},{default:c(()=>[S(x(w),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})],64)}}});var Zo=P(Vo,[["__scopeId","data-v-7f6c3ce0"]]);const Go=[{path:"/",redirect:"/home/device",name:"default"},{path:"/login",name:"Login",component:wo},{path:"/home",name:"Home",component:Ko,redirect:"/home/device",meta:{requiresAuth:!0},children:[{path:"/home/dashboard",name:"Dashboard",component:fo},{path:"/home/simulator",name:"Simulator",component:To},{path:"/home/device",name:"Device",component:At},{path:"/home/update",name:"Update",component:Gt},{path:"/home/operator",name:"Operator",component:Zo},{path:"/home/configure",name:"Configure",component:io},{path:"/home/automation",name:"Automation",component:lo},{path:"/home/help",name:"Help",component:uo}]}],ke=ot({history:st(),routes:Go,scrollBehavior(t,e,o){return o||{top:0}}});ke.beforeEach((t,e,o)=>{const r=localStorage.getItem("accessToken")||"";t.matched.some(n=>n.meta.requiresAuth)?(console.log("token= "+r),r?o():o("/login")):o()});const Se=nt(dt);Se.config.globalProperties={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0};const Le=at();Le.use(it);Se.use(ke).use(Le).mount("#app");
